# 기술 교육

국중진 멘토

2017.07.11
———————————————————————————

## Part 1: IoT Hub (ARTIK 710)


## Part 2: IoT End-Device (ARTIK 053)

———————————————————————————
	ARTIK Module

Hub 520, 1010 -> 중간 성능인 710이 추가 됨

053, 710이 삼성전자에서 밀고 있는 메인 모듈.


라즈베리파이의 경우에는 ADC(I/O)가 없지만 ARTIK은 지원하는 중.

아틱 053의 경우 자료가 별로 없음.
나눠준 자료가 이것에 대한 거의 모든 자료.
타이젠 RT라는 RTOS가 올라가 있음.
RTOS이기 때문에 개발 환경이 생소할 수 있음.

053의 경우 ARTIK IDE (ARTIK SDK)를 사용
710의 경우 Eclipse Che or Linux with ARTIK SDKs(C/C++/node.js)


	ARTIK Cloud Platform

아틱이 갖는 장점이 무엇이냐?
보안! 보안이 우수하다.
물리적인 칩 보안, 네트워크 보안, 클라우드 보안 등이 우수하다.
개발자나 사용자에겐 크게 와닿지 않는 부분. 특성이 모호하다.


기존 클라우드 플랫폼의 경우 스토리지의 개념이 많았음.
아틱 클라우드 플랫폼의 경우 메시지. 1KB. 센싱된 데이터를 수집하기 위한 클라우드. 메시지를 통해 액션을 취함.
이러한 룰을 설정할 수 있음. 이 기종의 디바이스가 상호작용할 수 있는 플랫폼을 제공한다.

아틱 디바이스에 연결된 것들을 소프트웨어로 식별한다. 각 기기의 ID값이 아니다.

	아틱 클라우드 기능
디바이스를 등록. 어떤 디바이스에 어떤 액션을 취해라하는 룰을 정의. 차트. 로그. 데이터 익스포트.


	710
라즈베리파이의 경우 안면인식을 할 경우 퍼포먼스가 떨어짐. 빌드타임이 길다. opencv를 처리하는데 오래 걸린다. 최대 5프레임.
아틱의 경우 BSP 안에 필요한 것들이 이미 올라와 있음. CPU 파워가 강해서 조금 더 빠름. 강력한 하드웨어적 성능.


센서, 액츄에이터가 제대로 동작하지 않을 경우 전압이 적절한지 확인해봐야 한다. (전압 세팅 확인)
MIPI 기반의 모듈이 없어도 HDMI를 사용하는 미니 모니터, USB 웹캠 등을 사용 가능.


아틱 7 Power
점퍼 세팅을 해주어야 함.
배터리와 어댑터의 세팅이 다름.
회로가 고장날 경우 판단이 어려움. 전원 부분을 다룰 때 신중할 필요가 있음.

터미널용 디버그 usb.
PC와 보드 연결.
아두이노 등 다른 상황에서는 위쪽에 연결한다.
기본적으로는 밑에 연결하면 된다.

USB를 꼽고 Power switch를 켜면 전원을 받고 있지만 부팅은 안 되는 상태.
하얀색 스위치를 1초 이상 누르고 있으면 부팅된다.



	GPIO
일반적인 목적의 시리얼 포트.
일반적으로 input, output 외에 다른 식으로도 작동할 수 있도록 해놓음.

	레지스터
 메모리 공간에 매핑을 시켜놓음.

	Sys file system
사용자가 시스템에 접근하기 위해선 system call로 밖에 접근할 수 없는 건데 이것을 이용해 접근하기 쉽게 해줌
    # cd /sys/class/gpio/gpio38
    # ls
확인할 수 있음.

symbolic link 'l' : 다른 파일을 가리키고 있다.

export라는 파일에 gpio index를 매겨줬더니 sys file system이 해당 포트와 연결해줌.
direction 파일에 in/out 타입을 적을 수 있다.
value라는 파일에 0이나 1을 써줌으로써 on/off를 설정할 수 있다.

	p58.
80핀이 인터페이스 보드에 구성되어 있음.
각각의 헤더별로 마킹되어 있음.
핀의 역할이 나와 있다.
vcc, ground -> 전원 구성

각각의 헤더별로 어떤 레지스터가 매핑되어 있는지 확인할 수 있음.
data sheet, skematic을 통해 확인할 수 있음.

	p59.
silk index - low level index - system level index가 다 다르다. 잘 확인해야함.

	p60.
아틱의 경우 아두이노와의 호환성을 제공하면서 아두이노 핀 넘버를 매겨 접근할 수 있게 해준다. 여기서 또하나의 index가 나옴.
2~11까지의 핀 넘버를 사용함.


	p66.
LED를 핀으로 직접 연결할 경우 위험하다.
5V를 걸어주면 LED의 작동을 확신하지 못 한다. 장비의 내부회로가 고장날 수 있으니 주의.
저항을 통해 anode, cathod가 견딜 수 있는 정도로 낮춰주어야 한다.
아두이노용 포트는 2번부터 시작하기 때문에 GPIO6을 8번으로 볼 수 있음.

	p67.
아틱 기반의 아두이노다 보니까 터미널로 보내는 것이 아니다.
이더넷을 사용해 보내던가, 파일 전송 유틸리티로 보내야함.
컴파일된 바이너리 내보내기 기능을 통해 이 파일을 아틱에 보내야함.
아틱에서는 이 파일의 퍼미션을 수정한 후 실행해주면 된다.
아틱의 아두이노 호환성 : 리눅스 환경에서 아두이노 펌웨어를 새로운 프로세스로 등록해서 실행하겠다.

	p70.
네트워크 업로드를 통해 올려주는 것도 가능하다. 아틱의 홈디렉토리로 올라감.

	p71.
watcher
    # /root/watcher &
watcher를 통해 아두이노의 시리얼 포트를 설정해 코드를 올리는 것처럼 사용가능.
하지만 usb포트를 하나 더 사용해야함.
종료
- ctrl + \ (quit)
- jobs -> # fg 1 -> ctrl + \
    - fg 명령어는 프로세스를 foreground 모드로 전환해줌.


아틱은 여러가지 프로그래밍 언어를 통해 접근할 수 있음.
방식만 약간 다르기 때문에 그것만 주의하면 된다.

ARTIK 예제는 File 기반으로 구현한 것으로 큰 의미는 없음.
sys file system 상의 I/O 예제는 다 같은 방식.

	ARTIK SDK
artik.io 홈페이지에서 받을 수 있음.
resource -> module documentation
software API
repository와 key값 관련 내용을 보고 진행해야 파일을 받을 수 있음.

sdk를 사용할 경우
	libartik-sdk-base(-devel)
	libartik-sdk-systemio(-devel)
이 두 개는 필수 설치.
(-devel까지 붙여서 설치를 하는 것이 좋음. 예제 파일도 제공)

	p89.
함수 포인터로 구현이 되어 있음. 매핑을 시켜주어야 함.
함수의 포인터 형태로 구현된 스트럭쳐(C), 추상메서드(C++), 인터페이스(Java)

온습도, 초음파, 모션 센셔와 같은 센서는 디지털 센서이기 때문에 High, Low가 반복이 됨.
얼마나 유지가 되느냐. 타이밍 특성이 중요하다. sys file system 접근 방식으로 접근할 경우
이것이 거의 불가능하기 때문에 아두이노 코드로 만들거나, SDK를 이용하는 것이 좋다.
아니면 Low level로 코딩을 해야되는 데 이것은 너무 간 것.


	p90.
전처리를 수행하고 object 파일을 만들고 링킹을 함. 그리고 로더에 대한 정보를 받아서 실행파일을 만들게 된다.
이 과정을 빌드라고 함. ARTIK은 프로세서가 ARM이기 때문에 arm- 컴파일러를 사용함. PC linux 환경에서 빌드를 할
경우 x16이기 때문에 flag가 필요함. 아틱에서는 gcc를 이용해 그냥 컴파일하면 된다.
Makefile의 대략적인 과정은 나중에 수정을 위해 알아두는 것이 좋다.


	p91.
	Programmable GPIOs
기본적으로 analog output은 없음.
PWM
- Pulse Width Modulation
- 펄스 폭을 조절해서 전압이 바뀌는 것과 같은 효과를 낸다.
ADC
- Analog to Digital Converter
- 6개의 채널 제공
GPIO
- Digital I/O
Serial
- PC and UART

센서 중 I2C, SPI 등을 이용하는 경우도 많아서 어떻게 이용할지 알아보는 것도 필요함.


	p93.
아날로그는 linear한 파형
공급되는 전압 대비 몇 가지의 값으로 표현을 할 수 있는가로 디테일을 확인함.
내가 사용하는 센서가 어떤 것이냐에 따라 산술 연산이 필요함.
reference voltage가 5v일 때와 비교해서 어떻게 변하는지 계산해야 한다.


--------- 1일차

	p93.
TMP36 온도 센서
1핀 전원.
2핀 센싱된 정보값, 아날로그.
3핀 그라운드.

아날로그센서 가변 저항, 조도센서, 온도센서

	p94.
온도에 따라 저항의 크기가 달라진다.
입력 대비 출력되는 전압은 달라짐.

	p95.
ADC의 경우도 sysfs를 통해 파일을 읽어 값을 확인할 수 있다.
12bit 범위의 resolution을 갖는 ADC가 내장되어 있음.
ADC raw(출력 전압)의 차이를 통해 온도를 유추해볼 수 있다.
이전 그래프를 볼 때 전압의 변화와 온도의 변화가 선형적으로 변하기 때문.

아두이노의 경우는 API를 제공하기 때문에 아날로그 포트의 값을 바로 확인할 수 있음.
sysfs의 c 예제에서는
하지만 클라우드로 데이터를 올려주고자 한다면 네트워크와 관련한 부분에서 조금 애매해질 수 있음.
c로 sysfs를 읽는 방식으로 개발하여 소켓을 통해 전달하는 것으로 해결.
아두이노를 사용하고 싶은 경우, 아두이노로 값을 읽고 이를 파이프를 이용하거나 공유 파일, 공유 메모리를 통해 해결해야 한다.

	p98.
데이터 시트를 통해 센서의 값과 다른 환경 변수의 관계가 표시되어 나온다. 이를 참고.
예) 빛의 밝기와 저항

	p99.
10단위의 수
0	1	2	3	4	5	6	7	8	9
흑	갈	적	주	노	초	파	보	회	흰
예) 갈 흑 주 - 삼색 띠
	10^3
저항의 값을 뺀 나머지만 ADC에 전달이 된다.
참고 : [링크](https://en.wikipedia.org/wiki/Electronic_color_code)

I2C
아틱 - 마스터
온도 센서 - 슬레이브
프로토콜을 가짐.
언제 쓸 것인지 언제 받아올 것인지에 대한 타이밍이 제공된다.
CLI 명령어 기반의 유틸리티를 사용한 책의 예제는 단순히 이 방식을 확인하기 위한 것.
아틱 SDK를 사용하는 것이 좋다.

아틱 기반의 아두이노 환경에서 센서를 테스트해보고 사용해야 한다.
모든 기능이 동일하게 작동하지는 않는다.

PWM
sysfs을 통해 인터페이스를 제공한다.
아틱 silk marking PWM0이 실제로는 PWM2로 정의되어 있음.
여러 개의 인덱스가 혼용 중. PWM2 포트를 활성화시켜야 한다.
period, duty cycle, enable의 파일이 생긴다.
앞의 두 가지는 nano sec 단위의 시간을 나타낸다. 마지막 변수는 flag.
직접 전압을 조절할 수 없기 때문에 period와 duty cycle을 조절하는 식의 방법을 이용한다.
50% duty cycle -  절반의 전압이 제공되는 효과.

	p108.
Makefile 없이 이 명령어만 쳐도 된다.
-I(대문자 I) 옵션은 include를 나타낸다.
default directory에 존재하지 않는 library를 사용할 때는 include시켜줘야 한다.
(/usr/lib에 있지 않은 것)
-l(소문자 L)를 통해 Library(sdk 위치)를 표시해줌.
표시해주지 않을 경우 unresolved symbol 에러가 난다.

	p109.
디지털 센서 중 온습도 센서
DHT11/22 핀의 구성은 동일.
11은 상온만 측정이 가능. 22는 영하도 가능.
출력할 때의 형식이 약간 차이가 있음.
3핀 NC(Not connected) : 사용하지 않음.

	p111.
아틱 보드 : MCU쪽
센서 파트 : DHT쪽

얼마나 high level을 유지시키느냐에 따라 0이냐 1이냐가 달라진다.
따라서 타이밍 특성을 맞추어 보내주어야 한다.
start signal을 보낸 후에 실제 데이터를 보낸다.

이러한 이유로 마이크로 세컨드 단위를 처리할 수 있는 로직이 필요하다.
파이썬의 경우 이러한 특성을 거의 맞추지 못함. c로 만든 라이브러리를 따로 찾아서 써야함..
그래서 c로 처음부터 짜는 것이 좋다.
타이밍 특성에 대한 고려가 필요하다.
타이밍 resolution을 제공하는 CPU냐 이런 것도 중요한데 요즘엔 하드웨어가 좋아서 대부분 지원.

하나의 포트에 대해 인풋 아웃풋이 바뀌는 것에 따라 온습도 측정이 가능.
총 40bit.
데이터 32bit. 상위 16bit는 습도, 하위 16bit는 온도.
시리얼하게 연달아 보내는 구조이다보니 타이밍이 잘못될 경우 데이터 해석이 잘못되는 상황이 발생함.
때문에 마지막 한 바이트를 checksum으로 사용한다.
이를 통해 잘못 보내거나 잘못 받은 것을 알아챌 수 있다.

	p115.
핀이 잘못되었음. 6번이다.
DHT22 예제이기 때문에 18 Micro seconds 이상으로 바꿔주어야함.
80 마이크로 세컨드를 유지한 후, 그 이후 받는 것이 데이터임.
value 함수
- 하나의 펄스를 읽어들이기 위한 것.
- 바이트 단위로 0과 1을 채워주고 shift해가면서 데이터를 완성한다.

Node-RED
UI 기반의 코딩 블록 사용.
소프트웨어 개발이 아닌 직관적인 툴을 사용하는 방식.
아틱 센서 제어 가능
센싱된 데이터를 클라우드로 올려주고 다른 디바이스와 상호작용할 수 있다.

범용적인 툴이기 때문에 아틱 전용의 블락을 추가해주어야 한다.
- 이 두 가지 모듈을 추가로 설치해주어야 한다.
	- node-red-contrib-artik
	- node-red-contrib-artik-cloud

cf. 사설 ip
192.168.xxx.xxx
10.xxx.xxx.xxx=
- 내부망 외부에서 접근 불가
netmask 255.255.255.0
8bit씩 나눠짐.


	아틱 클라우드
디바이스 별 ID를 확인하고 토큰을 발급 받아 저장해놔야 한다.
Device ID
- 클라우드에서 새로운 디바이스를 식별하기 위한 것
- 데이터를 올리거나 받아올 때도 사용함.

Device Type ID
- 새로운 타입의 디바이스를 만들었을 경우 자신이 등록해주어야 함.

Device token
- REST API를 호출하기 위한 과정에서 사용하기 위한 토큰
- 데이터를 올릴 때도 사용함.

해당 디바이스에 대한 Attribute를 등록할 수 있음. 이것을 차트로 확인 가능(모니터링).
실제로 어떤 데이터를 발생시키기 시작하면 노티가 나오면서 데이터가 찍히기 시작한다.
attribute 이름이 일치해야 데이터를 보내고 이를 받아서 확인할 수 있다.

아틱 클라우드는 단순히 데이터 저장을 위한 것이 아니다.
메시지 트랜스미션을 처리하기 위한 클라우드.
메시지와 액션을 받기 위한 것.
이 중 어떤 것을 받을 지 선택할 수 있음.

    dnf clean all

		dnf distort-sync —refresh

파일 확인
- /etc/yum.repos.d/fedora.repo
- fedora-update.repo


ARTIK Multimedia
보통의 리눅스, M플레이어를 많이 사용, S플레이, VLC 등.


ARTIK 7 - USB Camera
system 레이어에서 보통 다 해줌.
내부 버퍼에 저장된다. dmeg 커맨드로 확인 가능.

	p153.
OpenCV
아틱에 opencv가 올라가 있음. 따로 설치할 필요 없음.
`를 사용. 홑따옴표가 아니다.

실시간 스트리밍, cctv 같은 서비스를 만들고 싶을때?
ffserver 기능을 확인해보기


	p335.
예제 코드. example/artik\ cloud/
web socket을 사용하여 데이터를 교환할 때
처음에 registration 과정이 필요하다.
GPIO 모듈의 경우 라즈베리파이 환경에서만 테스트해봄.
아틱 환경에서 제대로 동작하는지 확인이 필요하다.



	소형 디바이스
라즈베리파이
- 35달러

라즈베리파이 제로
- 5달러
- usb 포트가 따로 없음
- 커넥티비티를 제공하지 못함
- 다른 라즈베리파이의 절반 크기

라즈베리파이 w
- 10달러
- 무선 기능이 적용됨.
- 제로와 사이즈가 같음.

파티클 포톤
- 와이파이 들어감
- GPIO
- 아두이노 호환
- 클라우드 연동

spark fun esp32 thing
- 와이파이 적용
- 20달러

설계까지 할 필요 없이 나와있는 것을 이용하는 것이 효율적이다.


	p164.
	ARTIK 053
- 나온 지 얼마 안 됨. 2달 정도.
- TIZEN RT OS가 올라가 있음.
TIZEN RT
- 나온 지 얼마 안 됨.

아틱 IDE
- windows용

아틱 053 환경에서는 어떤 방식으로 센서와 연결을 해야되며 어떻게 클라우드로 올릴 수 있을까?
이것이 포인트.

이벨루젼 키트
- 전체 보드

인터포져 보드
- CPU 포함된 곳

usb 커넥터를 통해 연결할 경우 DC전원을 굳이 연결 안 해도 된다.
아두이노 정도 급의 낮은 CPU 파워가 필요한 제품.
커넥티비티는 와이파이만 지원.
일반적인 인터페이스는 다 갖추고 있음.
아날로그를 사용하기 위해 AD컨버터를 따로 구성할 필요 없음.

	p169.
디폴트는 1,2. USB 전원.
DC파워를 사용하기 위해서는 3, 4 점퍼 이용.

	p170.
GPIO configuration
TIZEN RT source를 확인


Groove base shield 아두이노 호환용 쉴드 이용 가능.
센서를 패키지 형태로 모듈로 만들어 판매하는 경우 고가로 판매된다.

	p171.
JTAG
- ice(?) 관련해서 많이 사용했었음.
- 10년 전에 많이 사용.
- 어플리케이션을 만드는 수준에서는 별로 필요 없음.
임베디드 디버거 비쌈.

	ARTIK 053
크기 자체는 710과 비슷함.
장치 관리자를 통해 보면 JTAG, UART 두 가지가 나오게 된다.
Linux : /dev/ttyUSBx
Mac OS : /dev/tty.usbserial.xxx

리셋을 눌렀을 때 가만히 있으면 on-boarding mode로 돌게 된다.
	on-boarding mode
- softAP로 작동되면서 스마트폰과의 연결과 같은 형식으로 이용된다.
리셋 후 일정 시간 안에 키를 누르면 CLI 환경으로 작동된다.
	CLI mode
- 리눅스와 비슷해보이지만 다르다.
- 리눅스에서 사용했던 명령어의 대부분을 사용할 수 없음.


--------- 2일차

———————————————————————————
